#!/bin/bash

testDir="../cycleTracksTest"

if [ -d "$testDir" ]; then
    rm -rf $testDir/*
else
    mkdir -p $testDir
fi

cd $testDir

echo "cd $testDir"

git clone git@github.com:keziah55/cycleTracks.git

cd cycleTracks

python3 -m venv .

source bin/activate

python -m pip -V

python -m pip install -r requirements.txt --no-cache-dir
python -m pip install pytest pytest-qt pytest-cov pytest-profiling --no-cache-dir

# test with pyside2, then pyqt5
export QT_API=pyside2
export PYTEST_QT_API=pyside2
python -m pytest -v --cov=cycleTracks --cov-report term-missing --profile-svg $@
mv prof prof-pyside2

export QT_API=pyqt5
export PYTEST_QT_API=pyqt5
python -m pytest -v --cov=cycleTracks --cov-report term-missing --profile-svg $@
mv prof prof-pyqt5

deactivate